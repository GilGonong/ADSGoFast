{
	"name": "335_vw_TeachingGroup",
	"properties": {
		"content": {
			"query": "DROP VIEW IF EXISTS dbo.vw_TeachingGroup;\nGO\n\nCREATE VIEW dbo.vw_TeachingGroup\nAS\nSELECT DISTINCT\n    TG.RefId,\n    StudentList.StudentPersonalRefId,\n    TeacherList.StaffPersonalRefId,\n    TeacherList.Association,        \n    PeriodList.DayId,\n    PeriodList.PeriodId,    \n    TG.SchoolYear,\n    TG.LocalId,\n    TG.ShortName,\n    TG.LongName,\n    TG.GroupType,\n    CAST(TG.[Set] AS INT) [Set],\n    CAST(TG.Block AS INT) Block,\n    TG.CurriculumLevel,\n    TG.SchoolInfoRefId,\n    TG.SchoolLocalId,\n    TG.SchoolCourseInfoRefId,\n    TG.SchoolCourseLocalId,\n    TG.TimeTableSubjectRefId,\n    TG.TimeTableSubjectLocalId,\n    TG.KeyLearningArea,\n    TG.Semester,\n    TG.MinClassSize,\n    TG.MaxClassSize     \nFROM OPENROWSET(\nBULK 'samples/sif/TeachingGroup/TeachingGroup/Snapshot/TeachingGroup/**',\nDATA_SOURCE ='sif_eds',\nFORMAT='PARQUET'\n) \nWITH(\n    RefId VARCHAR(50),\n    SchoolYear VARCHAR(4),\n    LocalId VARCHAR(50),\n    ShortName VARCHAR(20),\n    LongName VARCHAR(255),\n    GroupType  VARCHAR(255),\n    [Set] VARCHAR(4),\n    Block VARCHAR(4),\n    CurriculumLevel VARCHAR(255),\n    SchoolInfoRefId VARCHAR(50),\n    SchoolLocalId VARCHAR(50),\n    SchoolCourseInfoRefId VARCHAR(50),\n    SchoolCourseLocalId VARCHAR(50),\n    TimeTableSubjectRefId VARCHAR(50),\n    TimeTableSubjectLocalId VARCHAR(50),\n    KeyLearningArea VARCHAR(20),\n    Semester VARCHAR(50),\n    MinClassSize VARCHAR(4),\n    MaxClassSize VARCHAR(4),\n    StudentList VARCHAR(MAX),\n    TeacherList VARCHAR(MAX),\n    TeachingGroupPeriodList VARCHAR(MAX)\n) AS TG    \nCROSS APPLY OPENJSON(TG.StudentList,'$.TeachingGroupStudent')\n        WITH (\n        StudentPersonalRefId VARCHAR(50),\n        StudentLocalId VARCHAR(50),\n        [Name] NVARCHAR(MAX) '$.Name' AS JSON,\n        id int '$.sql:identity()'\n    ) AS StudentList\nCROSS APPLY OPENJSON(TG.TeacherList,'$.TeachingGroupTeacher')\n        WITH (\n        Association VARCHAR(100),\n        StaffPersonalRefId VARCHAR(50),\n        StaffLocalId  VARCHAR(50),\n        [Name] NVARCHAR(MAX) '$.Name' AS JSON,\n        id int '$.sql:identity()'\n    ) AS TeacherList\nCROSS APPLY OPENJSON(TG.TeachingGroupPeriodList,'$.TeachingGroupPeriod')\n        WITH (\n        DayId VARCHAR(1),\n        PeriodId INT,\n        id int '$.sql:identity()'\n    ) AS PeriodList\n\n-- SELECT * FROM dbo.vw_TeachingGroup    \n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sif2",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}